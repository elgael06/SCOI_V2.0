"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),_get=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}},Botonera_accion=function(n){function t(){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"btn-group"},React.createElement("span",{className:"btn btn-primary",onClick:this.props.on_ecxel},React.createElement("label",{className:"fa fa-file-excel-o"})," ECXEL"),React.createElement("span",{className:"btn btn-primary",onClick:this.props.on_resultados},React.createElement("label",{className:"fa fa-area-chart"}),"  RESULTADOS"),React.createElement("span",{className:"btn btn-primary",onClick:this.props.on_deshacer},React.createElement("label",{className:"fa fa-close"}),"  DESHACER"))}}]),t}(React.Component),Elementos=function(n){function t(){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("div",null,React.createElement("div",{style:{width:"200px",display:"inline-block"},className:"form-group"},React.createElement("span",{className:"glyphicon glyphicon-tasks"},React.createElement("label",{style:{marginLeft:"5px"}},"ESTABLECIMIENTO:")),React.createElement("select",{className:"form-control",onChange:this.props.on_establecimiento},React.createElement("option",{value:"-1"},"SELECCIONAR..."),this.establecimientos())),React.createElement("div",{style:{width:"200px",display:"inline-block",marginLeft:"15px",marginTop:"0px",position:"absolute"},className:"form-group"},React.createElement("span",{className:"fa fa-calendar"},React.createElement("label",{style:{marginLeft:"5px"}},"INICIO:")),React.createElement("input",{type:"date",className:"form-control",value:this.parseo_fecha(this.props.fecha_1),onChange:this.props.seleccion_fecha_1})),React.createElement("div",{style:{width:"200px",display:"inline-block",marginLeft:"225px",marginTop:"0px",position:"absolute"},className:"form-group"},React.createElement("span",{className:"fa fa-calendar"},React.createElement("label",{style:{marginLeft:"5px"}},"TERMINO:")),React.createElement("input",{type:"date",className:"form-control",value:this.parseo_fecha(this.props.fecha_2),onChange:this.props.seleccion_fecha_2})))}},{key:"parseo_fecha",value:function(n){var t=n.split("/");return t[2]+"-"+t[1]+"-"+t[0]}},{key:"establecimientos",value:function(){var n=this,t=function(t){return t==n.props.estado.folio_establecimiento};return this.props.establecimientos.map(function(n){return React.createElement("option",{key:n.id_establecimiento,selected:t(n.id_establecimiento),value:n.id_establecimiento},n.nombre_establecimiento)})}}]),t}(React.Component),Resultados=function(n){function t(){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("div",null,this.total_limpieza(),this.total_surtido(),this.total_imagen(),this.total_caducidad(),this.total_senializacion(),this.total_generales(),this.total_abs())}},{key:"resultados",value:function(n){var t=0,i=0,r=0,u=this.props.lista.filter(n);return u.forEach(function(n){t+=n.rsi;i+=n.rno;r+=n.rna}),Math.round(t/(t+i)*1e4)/100||"--"}},{key:"total_limpieza",value:function(){var n=0;return n=this.resultados(function(n){return n.limpieza>0}),this.resultado(n,"LIMPIEZA")}},{key:"total_surtido",value:function(){var n=0;return n=this.resultados(function(n){return n.surtido>0}),this.resultado(n,"SURTIDO")}},{key:"total_imagen",value:function(){var n=0;return n=this.resultados(function(n){return n.imagen>0}),this.resultado(n,"IMAGEN")}},{key:"total_caducidad",value:function(){var n=0;return n=this.resultados(function(n){return n.caducidad>0}),this.resultado(n,"CADUCADO")}},{key:"total_senializacion",value:function(){var n=0;return n=this.resultados(function(n){return n.senializacion>0}),this.resultado(n,"SEÑALIZACION")}},{key:"total_generales",value:function(){var n=0;return n=this.resultados(function(n){return n.generales>0}),this.resultado(n,"GENERAL")}},{key:"total_abs",value:function(){var n=0,i=this.resultados(function(n){return n.limpieza>0}),r=this.resultados(function(n){return n.surtido>0}),u=this.resultados(function(n){return n.imagen>0}),f=this.resultados(function(n){return n.caducidad>0}),e=this.resultados(function(n){return n.senializacion>0}),o=this.resultados(function(n){return n.generales>0}),t=0;return n=[i,r,u,f,e,o].filter(function(n){return n>=0?(t+=n,!0):!1}),n=t/n.length||0,n=Math.round(n*100)/100||"--",console.log("Total:",n),this.resultado(n,"TOTAL:")}},{key:"resultado",value:function(n,t){return React.createElement("div",{style:{width:"85px",display:"inline-block",marginLeft:"35px",textAlign:"center"}},React.createElement("label",null,t),React.createElement("span",{className:"form-control",style:{width:"70px",display:"inline-block",textAlign:"right"}},n),React.createElement("span",{className:"fa fa-percent",style:{display:"inline-block"}}))}}]),t}(React.Component),Tabla_departamentos=function(n){function t(){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{id:"contenedor_resultados"},React.createElement("table",{id:"resultados",className:"table table-bordered"},React.createElement("thead",null),React.createElement("tbody",null,this.construir_cuerpo())))}},{key:"resultados_pertenece",value:function(n){var t=0,i=0,u=0,r=0,f=this.props.lista.filter(n);return f.forEach(function(n){t+=n.rsi;i+=n.rno;u+=n.rna}),r=Math.round(t/(t+i)*1e4)||0,r/100}},{key:"construir_cuerpo",value:function(){var n=this,t="";return this.props.lista.map(function(i,r){var u=[];return r==0&&(t=i.zona_inspeccion,u.push(n.cavecera(t))),t==i.zona_inspeccion?u.push(n.fila(i)):(u.push(n.pie_departamento(t)),t=i.zona_inspeccion,u.push(n.cavecera(t)),u.push(n.fila(i))),r==n.props.lista.length-1&&u.push(n.pie_departamento(t)),u})}},{key:"cavecera",value:function(n){return React.createElement("tr",{className:"info"},React.createElement("th",null,"#"),React.createElement("th",null,n),React.createElement("th",{style:{background:"green",color:"azure"}},"SI"),React.createElement("th",{style:{background:"red",color:"azure"}},"NO"),React.createElement("th",{style:{background:"blue",color:"azure"}},"NA"),React.createElement("th",null,"LIMPIEZA"),React.createElement("th",null,"SURTIDO"),React.createElement("th",null,"IMAGEN"),React.createElement("th",null,"GENERALES"),React.createElement("th",null,"SEÑALIZACION"),React.createElement("th",null,"CADUCIDAD"))}},{key:"fila",value:function(n){var i=function(n){return n>0?"green":"black"},r=function(n){return n>0?"red":"black"},u=function(n){return n>0?"blue":"black"},t=function(n,t,i){return n>0?t>0?"green":i>0?"red":"blue":""};return React.createElement("tr",null,React.createElement("td",null,n.posicion),React.createElement("td",null,n.pregunta),React.createElement("td",{style:{color:i(n.rsi)}},n.rsi),React.createElement("td",{style:{color:r(n.rno)}},n.rno),React.createElement("td",{style:{color:u(n.rna)}},n.rna),React.createElement("td",{style:{background:t(n.limpieza,n.rsi,n.rno,n.rna)}},n.limpieza),React.createElement("td",{style:{background:t(n.surtido,n.rsi,n.rno,n.rna)}},n.surtido),React.createElement("td",{style:{background:t(n.imagen,n.rsi,n.rno,n.rna)}},n.imagen),React.createElement("td",{style:{background:t(n.generales,n.rsi,n.rno,n.rna)}},n.generales),React.createElement("td",{style:{background:t(n.senializacion,n.rsi,n.rno,n.rna)}},n.senializacion),React.createElement("td",{style:{background:t(n.caducidad,n.rsi,n.rno,n.rna)}},n.caducidad))}},{key:"pie_departamento",value:function(n){var o=0,t=this.resultados_pertenece(function(t){return t.limpieza>0&&t.zona_inspeccion==n}),i=this.resultados_pertenece(function(t){return t.surtido>0&&t.zona_inspeccion==n}),r=this.resultados_pertenece(function(t){return t.imagen>0&&t.zona_inspeccion==n}),u=this.resultados_pertenece(function(t){return t.caducidad>0&&t.zona_inspeccion==n}),f=this.resultados_pertenece(function(t){return t.senializacion>0&&t.zona_inspeccion==n}),e=this.resultados_pertenece(function(t){return t.generales>0&&t.zona_inspeccion==n});return o=(t+i+r+u+f+e)/6||0,React.createElement("tr",{className:"success"},React.createElement("th",{colspan:"5"},React.createElement("span",null,"TOTAL")),React.createElement("td",{style:{textAlign:"right"}},t,React.createElement("span",{className:"fa fa-percent"})),React.createElement("td",{style:{textAlign:"right"}},i,React.createElement("span",{className:"fa fa-percent"})),React.createElement("td",{style:{textAlign:"right"}},r,React.createElement("span",{className:"fa fa-percent"})),React.createElement("td",{style:{textAlign:"right"}},e,React.createElement("span",{className:"fa fa-percent"})),React.createElement("td",{style:{textAlign:"right"}},f,React.createElement("span",{className:"fa fa-percent"})),React.createElement("td",{style:{textAlign:"right"}},u,React.createElement("span",{className:"fa fa-percent"})))}}]),t}(React.Component),App=function(n){function t(n){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n);this.lista_establecimientos=[];this.lista_resultados=[];this.state={folio_establecimiento:-1,inicio:this.fecha_hoy(),termino:this.fecha_hoy()};this.obtener_establecimientos()}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{className:"panel panel-default"},React.createElement("div",{className:"panel-heading"},React.createElement(Botonera_accion,{on_ecxel:this.hand_ecxel.bind(this),on_resultados:this.hand_resultados.bind(this),on_deshacer:this.hand_deshacer.bind(this)}),React.createElement(Elementos,{establecimientos:this.lista_establecimientos,on_establecimiento:this.hand_establecimiento.bind(this),estado:this.state,fecha_1:this.state.inicio,seleccion_fecha_1:this.on_seleccion_fecha1.bind(this),fecha_2:this.state.termino,seleccion_fecha_2:this.on_seleccion_fecha2.bind(this)}),React.createElement(Resultados,{lista:this.lista_resultados})),React.createElement("div",{className:"panel-body"},React.createElement(Tabla_departamentos,{lista:this.lista_resultados})))}},{key:"hand_ecxel",value:function(){console.log("ecxel");tableToExcel("resultados","Establecimientos.xlsx")}},{key:"hand_resultados",value:function(){console.log("resultados");this.state.folio_establecimiento>0&&this.obtener_resultados()}},{key:"hand_deshacer",value:function(){console.log("deshacer");this.lista_resultados=[];this.setState({folio_establecimiento:-1,inicio:this.fecha_hoy(),termino:this.fecha_hoy()})}},{key:"hand_establecimiento",value:function(n){console.log(n.target.value);this.lista_resultados=[];this.setState({folio_establecimiento:n.target.value})}},{key:"on_seleccion_fecha1",value:function(n){console.info(n.target.value);var t=n.target.value.split("-");t[0]>0?this.setState({inicio:t[2]+"/"+t[1]+"/"+t[0]}):this.setState({inicio:this.fecha_hoy()})}},{key:"on_seleccion_fecha2",value:function(n){console.info(n.target.value);var t=n.target.value.split("-");t[0]>0?this.setState({termino:t[2]+"/"+t[1]+"/"+t[0]}):this.setState({termino:this.fecha_hoy()})}},{key:"fecha_hoy",value:function(){var n=new Date,t=n.getDate()>9?n.getDate():"0"+n.getDate(),i=n.getMonth()+1>9?n.getMonth()+1:"0"+(n.getMonth()+1);return t+"/"+i+"/"+n.getFullYear()}},{key:"obtener_establecimientos",value:function(){var n=this;conexion_api_from_body("servicios/checkListServ.asmx/buscar_establecimiento",{},function(t){console.log("Establecimientos:",t.d);n.lista_establecimientos=t.d;n.setState({folio_establecimiento:-1})})}},{key:"obtener_resultados",value:function(){var n=this;conexion_api_from_body("servicios/checkListServ.asmx/procedimiento_resultados_cuestionario_por_rango_fechas",{inicio:this.state.inicio,termino:this.state.termino,folio_establecimiento:this.state.folio_establecimiento},function(t){console.log("Resultados:",t.d);n.lista_resultados=t.d;n.setState({});n.lista_resultados.length==0&&alert("SIN RESULTADOS...")})}}]),t}(React.Component);ReactDOM.render(React.createElement(App,null),document.getElementById("container"));