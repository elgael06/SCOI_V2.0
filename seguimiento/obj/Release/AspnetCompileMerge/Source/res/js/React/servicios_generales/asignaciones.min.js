"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),_get=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}},Asignar=function(n){function t(n){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n);this.lista_establecimientos=conexion_ajax("servicios/matriz/conexiones.asmx/obtener_establecimientos")||[];this.lista_cuestionarios=conexion_ajax("servicios/servicios_generales/conexiones.asmx/cuestionarios")||[];this.lista_aplicadores=conexion_ajax("servicios/checkListServ.asmx/obtener_lideres",{tienda:"todos"})||[];this.modal_activa="";this.seleccion_tabla_modal={folio:0,dato:""};this.cuerpo_tabla_modal=[];this.asignados_a_eliminar=[];this.lista_cuestionarios_asignados=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_asignados_vista_por_establecimiento",{folio:this.lista_establecimientos[0].folio})||[];this.cavecera_tabla_de_modal=[];this.titulo_modal="";this.titulo_seleccion="";this.posicion_seleccionado=0;this.state={edicion:!1,nuevo:!1,filtro_tabla_modal:"",folio:0,folio_cuestionario:0,cuestionario:"",folio_establecimiento:this.lista_establecimientos[0].folio,establecimiento:this.lista_establecimientos[0].nombre,estatus:"V",fecha:this.fecha_hoy(),fecha2:this.fecha_hoy(),id_aplicador:0,aplicador:""}}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("div",null,React.createElement(Botonera,{nuevo:this.nuevo.bind(this),editar:this.editar.bind(this),guardar:this.guardar.bind(this),deshacer:this.deshacer.bind(this),class_editar:this.state.edicion,class_nuevo:this.state.nuevo}),React.createElement("br",null),React.createElement("label",null,this.componente_establecimiento(),React.createElement("div",{style:{display:"inline-block","margin-left":"20px"}},React.createElement("div",{style:{width:"220px",display:"inline-block"}},React.createElement(Caja_datos_select,{icono:"glyphicon glyphicon-question-sign",titulo:"Estatus",seleccion:this.cambio_estatus.bind(this),opciones:this.opciones_estatus()})),React.createElement("label",null,React.createElement(Caja_fecha,{fecha:this.state.fecha,evento:this.on_fecha.bind(this)}),React.createElement(Caja_fecha,{fecha:this.state.fecha2,evento:this.on_fecha2.bind(this)}))),React.createElement("div",{style:{width:"75%",display:"inline-block","margin-left":"20px"}},React.createElement(Caja_datos,{icono:"glyphicon glyphicon-edit",titulo:"Cuestionario",datos:this.state.cuestionario}),React.createElement("i",{className:"glyphicon glyphicon-search","data-toggle":"modal","data-target":"#modal_",onClick:this.seleccionar_de_tabla_modal_cuestionario.bind(this)})),React.createElement("div",{style:{width:"75%",display:"inline-block","margin-left":"20px"}},React.createElement(Caja_datos,{icono:"glyphicon glyphicon-user",titulo:"Aplicador",datos:this.state.aplicador}),React.createElement("i",{className:"glyphicon glyphicon-search","data-toggle":"modal","data-target":"#modal_",onClick:this.seleccionar_de_tabla_modal_aplicador.bind(this)}))),React.createElement("div",{className:"contenedor_dias"},React.createElement("label",{className:"checkbox-inline"},React.createElement("input",{type:"checkbox",value:""}),"Domingo"),React.createElement("label",{className:"checkbox-inline"},React.createElement("input",{type:"checkbox",value:""}),"Lunes"),React.createElement("label",{className:"checkbox-inline"},React.createElement("input",{type:"checkbox",value:""}),"Martes"),React.createElement("label",{className:"checkbox-inline"},React.createElement("input",{type:"checkbox",value:""}),"Miercoles"),React.createElement("label",{className:"checkbox-inline"},React.createElement("input",{type:"checkbox",value:""}),"Jueves"),React.createElement("label",{className:"checkbox-inline"},React.createElement("input",{type:"checkbox",value:""}),"Viernes"),React.createElement("label",{className:"checkbox-inline"},React.createElement("input",{type:"checkbox",value:""}),"Sabado")),this.boton_editar(),React.createElement("div",{className:"tabla_matriz"},React.createElement(Tabla,{cavecera:["Cuestionario","Departamento","Evaluador","Inicio","Termino","Estatus",""],datos:this.datos_cuestionarios()})),React.createElement(Modal_con_tabla,{id:"modal_",titulo_modal:this.titulo_modal,icono_seleccion:"glyphicon glyphicon-edit",titulo_seleccion:this.titulo_seleccion,seleccionado:this.seleccion_tabla_modal.dato,texto_filtro:this.state.filtro_tabla_modal,evento_filtrar:this.on_filtro_tabla_modal.bind(this),cavecera_tabla:this.cavecera_tabla_de_modal,lista_tabla:this.cuerpo_tabla_modal,guardar:this.seleccionar_de_tabla_modal.bind(this),deshacer:this.des_seleccionar_de_tabla_modal.bind(this)}))}},{key:"componente_establecimiento",value:function(){return this.state.nuevo||!this.state.edicion?React.createElement("div",{style:{width:"20%",display:"inline-block","margin-left":"20px"}},React.createElement(Caja_datos_select,{titulo:"",icono:"glyphicon glyphicon-briefcase",seleccion:this.on_seleccion_establecimiento.bind(this),opciones:this.opciones_establecimientos()})):React.createElement("div",{style:{width:"20%",display:"inline-block","margin-left":"20px"}},React.createElement("h3",null,"Establecimiento : ",this.state.establecimiento))}},{key:"boton_editar",value:function(){if(this.state.edicion)return React.createElement("input",{type:"button",className:"btn btn-success btn-block",value:"Agregar",onClick:this.agregar_a_tabla.bind(this)})}},{key:"nuevo",value:function(){console.log("nuevo");this.lista_cuestionarios=conexion_ajax("servicios/servicios_generales/conexiones.asmx/cuestionarios")||[];this.posicion_seleccionado=this.lista_cuestionarios_asignados.length;this.posicion_seleccionado==0?this.setState({folio:0,edicion:!0,nuevo:!0}):alert(' El Establecimiento\n "Ya Tiene Campos"')}},{key:"editar",value:function(){console.log("editar");this.lista_cuestionarios=conexion_ajax("servicios/servicios_generales/conexiones.asmx/cuestionarios")||[];this.posicion_seleccionado=this.lista_cuestionarios_asignados.length+1;this.posicion_seleccionado>1?this.setState({edicion:!0,nuevo:!1}):alert('De En "Nuevo" \n ParaAgregar Datos Por Primera Vez!!!')}},{key:"guardar",value:function(){var n=this,r,t,i;this.state.edicion?this.lista_cuestionarios_asignados.length>0?function(){var u,f,e;console.log("guardar");u=[];r=0;f=[];e=n.lista_cuestionarios_asignados;e.map(function(t){return t.estatus=t.estatus=="Cancelado"?"C":"V",u.push(t.folio+","+t.folio_cuestionario+","+n.state.folio_establecimiento+","+t.id_aplicador+",'"+t.inicio+"','"+t.termino+"',"+t.estatus),n.fecha_hoy()>t.inicio&&t.inicio<t.termino&&f.push(t.folio+","+t.folio_cuestionario+","+n.state.folio_establecimiento+","+t.id_aplicador+",'"+t.inicio+"','"+t.termino+"',"+t.estatus),t});console.log(u);console.log(n.asignados_a_eliminar);n.asignados_a_eliminar.push(0);console.log(r);f.length==0?(t=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_guardar_asignados_cuestionario",{datos:u,eliminar:n.asignados_a_eliminar})||[],t.length>0&&(i="",t.map(function(n){return i+=n.respuesta+"\n",n}),alert("Guardado...\n"+i),console.log(t),n.deshacer())):(alert("Falta Validar La fecha De Uno o mas Campos!!!"),console.log("Error:"),console.log(f))}():alert("Coloque Datos En La Tabla Para Guardar!!!"):alert('Edicion "desactivada" ')}},{key:"deshacer",value:function(){console.log("deshacer");this.setState({edicion:!1,nuevo:!1,filtro_tabla_modal:"",folio:0,folio_cuestionario:0,cuestionario:"",folio_establecimiento:this.lista_establecimientos[0].folio,establecimiento:this.lista_establecimientos[0].nombre,estatus:"V",fecha:this.fecha_hoy(),fecha2:this.fecha_hoy(),id_aplicador:0,aplicador:""});this.asignados_a_eliminar=[];this.lista_cuestionarios_asignados=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_asignados_vista_por_establecimiento",{folio:this.lista_establecimientos[0].folio})||[]}},{key:"agregar_a_tabla",value:function(){var n=this,t=this.state.estatus=="C"?"Cancelado":"Vigente";console.log(this.state);console.log(this.fecha_hoy());console.log(this.checar_fecha());this.fecha_hoy()<=this.state.fecha&&this.state.fecha<=this.state.fecha2&&this.checar_fecha()?this.state.folio_cuestionario>0&&this.state.id_aplicador>0?(console.log(this.posicion_seleccionado),this.lista_cuestionarios_asignados[this.posicion_seleccionado]={folio:this.state.folio,folio_cuestionario:this.state.folio_cuestionario,cuestionario:this.state.cuestionario,departamento:this.lista_cuestionarios.filter(function(t){return t.folio==n.state.folio_cuestionario})[0].departamento,id_aplicador:this.state.id_aplicador,aplicador:this.state.aplicador,inicio:this.state.fecha,termino:this.state.fecha2,estatus:t},console.log(this.lista_cuestionarios_asignados),this.setState({folio:0,folio_cuestionario:0,cuestionario:"",estatus:"V",fecha:this.fecha_hoy(),fecha2:this.fecha_hoy(),id_aplicador:0,aplicador:""}),this.posicion_seleccionado=this.lista_cuestionarios_asignados.length+1):alert("Falta Seleccion Datos!!!"):alert("Error En Las Fechas")}},{key:"eliminar_de_tabla_datos_cuestionarios",value:function(n){if(this.state.edicion){var t=this.lista_cuestionarios_asignados.indexOf(n);console.log("Dato Eliminado De Posicion :"+t);this.lista_cuestionarios_asignados.splice(t,1);this.setState({filtro_tabla_modal:"",folio_cuestionario:0,cuestionario:"",estatus:"V",fecha:this.fecha_hoy(),fecha2:this.fecha_hoy(),id_aplicador:0,aplicador:""});this.posicion_seleccionado=this.lista_cuestionarios_asignados.length+1;n.folio>0&&this.asignados_a_eliminar.push(n.folio);console.log(this.asignados_a_eliminar)}else alert("Edicion Deshabilitada!!!")}},{key:"seleccionar_de_tabla_modal",value:function(){this.modal_activa=="cuestionario"?this.seleccionar_cuestionario():this.modal_activa=="aplicador"&&this.seleccionar_aplicador()}},{key:"des_seleccionar_de_tabla_modal",value:function(){this.seleccion_tabla_modal={folio:0,dato:""};this.setState({filtro_tabla_modal:""})}},{key:"seleccion_cuestionario",value:function(n){console.log(n);console.log(this.state);this.seleccion_tabla_modal={folio:n.folio,dato:n.cuestionario};this.setState({filtro_tabla_modal:""})}},{key:"seleccion_aplicador",value:function(n){console.log(n);console.log(this.state);this.seleccion_tabla_modal={folio:n.folio,dato:n.nombre};this.setState({filtro_tabla_modal:""})}},{key:"seleccionar_de_tabla_modal_cuestionario",value:function(){console.log("Seleccion Cuestionario");this.modal_activa="cuestionario";this.titulo_modal="Seleccion Cuestionario";this.titulo_seleccion="Seleccion Cuestionario";this.cavecera_tabla_de_modal=["folio","Cuestionario","Departamento","Estatus"];this.crear_tabla_modal("");this.setState({filtro_tabla_modal:"",folio_cuestionario:this.seleccion_tabla_modal.folio,cuestionario:this.seleccion_tabla_modal.dato});this.seleccion_tabla_modal={folio:0,dato:""}}},{key:"seleccionar_de_tabla_modal_aplicador",value:function(){console.log("Seleccion Aplicador");this.modal_activa="aplicador";this.titulo_modal="Seleccion Aplicador";this.titulo_seleccion="Seleccion Aplicador";this.cavecera_tabla_de_modal=["folio","Nombre","Puesto"];this.crear_tabla_modal("");this.setState({filtro_tabla_modal:""});this.seleccion_tabla_modal={folio:0,dato:""}}},{key:"seleccionar_cuestionario",value:function(){this.setState({filtro_tabla_modal:"",folio_cuestionario:this.seleccion_tabla_modal.folio,cuestionario:this.seleccion_tabla_modal.dato});this.seleccion_tabla_modal={folio:0,dato:""}}},{key:"seleccionar_aplicador",value:function(){this.setState({filtro_tabla_modal:"",id_aplicador:this.seleccion_tabla_modal.folio,aplicador:this.seleccion_tabla_modal.dato});this.seleccion_tabla_modal={folio:0,dato:""}}},{key:"on_seleccion_establecimiento",value:function(n){this.setState({folio_establecimiento:n.target.value,establecimiento:this.lista_establecimientos.filter(function(t){return t.folio==n.target.value})[0].nombre});this.lista_cuestionarios_asignados=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_asignados_vista_por_establecimiento",{folio:n.target.value})}},{key:"on_fecha",value:function(n){var t=n.target.value.split("-");console.log(t);this.setState({fecha:t[2]+"/"+t[1]+"/"+t[0]})}},{key:"on_fecha2",value:function(n){var t=n.target.value.split("-");console.log(t);this.setState({fecha2:t[2]+"/"+t[1]+"/"+t[0]})}},{key:"checar_fecha",value:function(){var n=!1;return this.state.fecha!="undefined/undefined/"&&this.state.fecha2!="undefined/undefined/"&&(n=!0),n}},{key:"cambio_estatus",value:function(n){this.setState({estatus:n.target.value})}},{key:"on_filtro_tabla_modal",value:function(n){this.crear_tabla_modal(n.target.value);this.setState({filtro_tabla_modal:n.target.value})}},{key:"seleccionar_cuestionario_de_tabla",value:function(n){console.log(n);console.log(this.lista_cuestionarios_asignados);this.posicion_seleccionado=this.lista_cuestionarios_asignados.indexOf(this.lista_cuestionarios_asignados.filter(function(t){return t==n})[0]);console.log("posicion:"+this.posicion_seleccionado);this.setState({folio:n.folio,folio_cuestionario:n.folio_cuestionario,cuestionario:n.cuestionario,estatus:n.estatus=="C"?"Cancelado":"Vigente",fecha:n.inicio,fecha2:n.termino,id_aplicador:n.id_aplicador,aplicador:n.aplicador})}},{key:"crear_tabla_modal",value:function(n){this.modal_activa=="cuestionario"?this.tabla_cuestionarios(n):this.modal_activa=="aplicador"&&this.tabla_aplicadores(n)}},{key:"fecha_hoy",value:function(){var n=new Date,t=n.getDate()>9?n.getDate():"0"+n.getDate(),i=n.getMonth()+1>9?n.getMonth()+1:"0"+(n.getMonth()+1);return t+"/"+i+"/"+n.getFullYear()}},{key:"opciones_estatus",value:function(){return[React.createElement("option",{selected:this.state.estatus=="V",value:"V"},"Vigente"),React.createElement("option",{selected:this.state.estatus=="C",value:"C"},"Cancelado")]}},{key:"opciones_establecimientos",value:function(){var n=this;return this.lista_establecimientos.map(function(t){return React.createElement("option",{selected:t.folio==n.state.folio_establecimiento,value:t.folio}," ",t.nombre)})}},{key:"tabla_cuestionarios",value:function(n){var t=this,i=this.lista_cuestionarios.filter(function(i){return i.cuestionario.toUpperCase().search(n.toUpperCase())>=0&&i.folio_establecimiento==t.state.folio_establecimiento});console.log(i);console.log(this.state.folio_establecimiento);this.cuerpo_tabla_modal=i.map(function(n){return React.createElement("tr",{onClick:function(){return t.seleccion_cuestionario(n)}},React.createElement("td",null,n.folio),React.createElement("td",null,n.cuestionario),React.createElement("td",null,n.departamento),React.createElement("td",null,n.estatus=="V"?"Vigente":"Cancelado"))})}},{key:"tabla_aplicadores",value:function(n){var t=this,i=this.lista_aplicadores.filter(function(t){return t.nombre.toUpperCase().search(n.toUpperCase())>=0});this.cuerpo_tabla_modal=i.map(function(n){return React.createElement("tr",{onClick:function(){t.seleccion_aplicador(n)}},React.createElement("td",null,n.folio),React.createElement("td",null,n.nombre),React.createElement("td",null,n.puesto))})}},{key:"datos_cuestionarios",value:function(){var n=this;return console.log("Asignados"),this.lista_cuestionarios_asignados.map(function(t){return React.createElement("tr",{onClick:function(){n.seleccionar_cuestionario_de_tabla(t)}},React.createElement("td",null,t.cuestionario),React.createElement("td",null,t.departamento),React.createElement("td",null,t.aplicador),React.createElement("td",null,t.inicio),React.createElement("td",null,t.termino),React.createElement("td",null,t.estatus),React.createElement("td",null,React.createElement("i",{className:"glyphicon glyphicon-remove red",onClick:function(){n.eliminar_de_tabla_datos_cuestionarios(t)}})))})}}]),t}(React.Component);ReactDOM.render(React.createElement(Asignar,null),document.getElementById("contenedor"));