"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),_get=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}},Check_list=function(n){function t(n){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n);this.lista_establecimientos=conexion_ajax("servicios/matriz/conexiones.asmx/obtener_establecimientos")||[];this.lista_datos_cuestionario=[];this.asignacion_seleccionada=[];this.lista_zonas_por_asignacion=[];this.lista_datos_por_zona=[];this.lista_responsables=conexion_ajax("servicios/checkListServ.asmx/obtener_lideres",{tienda:"todos"})||[];this.lista_cuestionarios_asignados=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_asignados_vista_por_establecimiento",{folio:this.lista_establecimientos[0].folio})||[];this.lista_servicios=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_detalles_ckl")||[];this.lista_servicios_por_cuestionario=[];this.lista_datos_cuestionario=[];this.nombre_cuestionario="";this.filtro_responsable="";this.responsable_tienda="";this.titulo_modal="";this.titulo_seleccion="";this.seleccion_tabla_modal={folio:0,dato:""};this.cavecera_tabla_de_modal=[""];this.cuerpo_tabla_modal=[];this.state={folio_establecimiento:this.lista_establecimientos[0].folio,establecimiento:this.lista_establecimientos[0].nombre,id_cuestionario:0,cuestionario:"",folio_asignacion:0,id_responsable:0,responsable:"",filtro_tabla_responsable_modal:"",evaluando:!1,seleccion_zona:{folio:0,nombre:""}};this.lista_observaciones=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_ver_observaciones_por_activo",{asignacion:this.state.folio_asignacion,folio_zona:this.state.seleccion_zona.folio})||[];this.cavecera_tabla_principal=["Folio","Cuestionario","Departamento","Evaluador","Inicio","Termino","Estatus"];this.tabla_principal=this.datos_cuestionarios()}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("div",null,React.createElement("div",{style:{width:"30%",display:"inline-block","margin-left":"20px"}},React.createElement(Caja_datos_select,{titulo:"",icono:"glyphicon glyphicon-briefcase",seleccion:this.on_seleccion_establecimiento.bind(this),opciones:this.opciones_establecimientos()})),React.createElement("div",{style:{width:"60%",display:"inline-block","margin-left":"20px"}},React.createElement(Caja_datos,{icono:"glyphicon glyphicon-edit",titulo:"Cuestionario",datos:this.state.cuestionario})),this.seleccion_responsable_boton(),this.boton_evaluar(),React.createElement("div",{className:"tabla_matriz"},React.createElement(Tabla,{cavecera:this.cavecera_tabla_principal,datos:this.tabla_principal})),React.createElement(Modal_con_tabla,{id:"modal_",titulo_modal:this.titulo_modal,icono_seleccion:"glyphicon glyphicon-edit",titulo_seleccion:this.titulo_seleccion,seleccionado:this.seleccion_tabla_modal.dato,texto_filtro:this.state.filtro_tabla_responsable_modal,evento_filtrar:this.on_filtro_tabla_modal.bind(this),cavecera_tabla:this.cavecera_tabla_de_modal,lista_tabla:this.cuerpo_tabla_modal,guardar:this.seleccionar_de_tabla_modal.bind(this),deshacer:this.des_seleccionar_de_tabla_modal.bind(this)}),React.createElement(Modal_cuestionario,{zona:this.state.seleccion_zona,datos_zona:this.lista_datos_por_zona,establecimiento:this.state.establecimiento,folio_establecimiento:this.state.folio_establecimiento,asignacion:this.state.folio_asignacion,departamento:this.state.departamento,responsable:this.state.id_responsable,lista_observacion:this.lista_observaciones,cuestionario:this.state.id_cuestionario}))}},{key:"seleccionar_de_tabla_modal",value:function(){console.log(this.seleccion_tabla_modal);this.setState({id_responsable:this.seleccion_tabla_modal.folio,responsable:this.seleccion_tabla_modal.dato});this.seleccion_tabla_modal={folio:0,dato:""}}},{key:"des_seleccionar_de_tabla_modal",value:function(){}},{key:"on_filtro_tabla_modal",value:function(n){this.cuerpo_tabla_modal=this.datos_responsables(n.target.value);this.setState({filtro_tabla_responsable_modal:n.target.value})}},{key:"on_seleccion_establecimiento",value:function(n){this.nombre_cuestionario="";this.cavecera_tabla_principal=["Folio","Cuestionario","Departamento","Evaluador","Inicio","Termino","Estatus"];var t=this.lista_establecimientos.filter(function(t){return t.folio==n.target.value})[0];console.log(n.target.value);this.cambio_vistas_servicios(n.target.value);this.setState({id_cuestionario:0,cuestionario:"",folio_asignacion:0,id_responsable:0,responsable:"",filtro_tabla_responsable_modal:"",folio_establecimiento:n.target.value,establecimiento:t.nombre,evaluando:!1,seleccion_zona:{folio:0,nombre:""}})}},{key:"on_seleccionar_cuestionario_de_tabla",value:function(n){console.log(n);n.id_aplicador==ID_SCOI?(this.cavecera_tabla_principal=["Folio","Cuestionario","Departamento","Evaluador","Inicio","Termino","Estatus"],this.asignacion_seleccionada=n,this.setState({id_cuestionario:n.folio_cuestionario,cuestionario:n.cuestionario,folio_asignacion:n.folio,departamento:n.departamento})):alert("Cuestionario No Seleccionable Por Usuario!!!")}},{key:"on_seleccionar_de_tabla_modal_responsable",value:function(){console.log("Responsable...");this.titulo_modal=" Seleccion De Responsable Tienda";this.titulo_seleccion="Responsable Tienda : ";this.seleccion_tabla_modal={folio:0,dato:""};this.cavecera_tabla_de_modal=["Folio","Nombre","Puesto"];this.cuerpo_tabla_modal=this.datos_responsables("");this.setState({filtro_tabla_responsable_modal:""})}},{key:"seleccion_responsable_de_modal",value:function(n){console.log(n);this.seleccion_tabla_modal={folio:n.folio,dato:n.nombre};this.cuerpo_tabla_modal=this.datos_responsables("");this.setState({filtro_tabla_responsable_modal:""})}},{key:"fecha_hoy",value:function(){var n=new Date,t=n.getDate()>9?n.getDate():0+n.getDate(),i=n.getMonth()+1>9?n.getMonth()+1:"0"+(n.getMonth()+1);return t+"/"+i+"/"+n.getFullYear()}},{key:"fechas_vigentes",value:function(n){return(console.log("Estatus : "+n),n=="Vigente")?(console.log("fecha Vigente"),!0):(console.log("Fuera De Rango De Fecha!!!"),!1)}},{key:"cambio_vistas_servicios",value:function(n){this.lista_cuestionarios_asignados=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_asignados_vista_por_establecimiento",{folio:n})||[];this.lista_zonas_por_asignacion=[];console.log(this.lista_cuestionarios_asignados);this.tabla_principal=this.datos_cuestionarios()}},{key:"motrar_datos_evaluacion_curso",value:function(){this.fechas_vigentes(this.asignacion_seleccionada.estatus)?this.state.id_responsable!=ID_SCOI?(console.log("Asignacion "+this.state.folio_asignacion),this.lista_zonas_por_asignacion=conexion_ajax("servicios/servicios_generales/conexiones.asmx/obtener_zonas_por_asignacion",{folio:this.state.folio_asignacion}),console.log(this.state.id_cuestionario),console.log(this.lista_datos_cuestionario),console.log(this.lista_zonas_por_asignacion),this.datos_zonas_cuestionarios(),this.setState({filtro_tabla_responsable_modal:"",evaluando:!0})):alert("Usuario Aplicador Y Usuario Responsable\n Son La Misma Persona!!!"):alert("Fuera De Rango De Fecha !!!")}},{key:"opciones_establecimientos",value:function(){var n=this;return this.lista_establecimientos.map(function(t){return React.createElement("option",{selected:t.folio==n.state.folio_establecimiento,value:t.folio}," ",t.nombre)})}},{key:"boton_evaluar",value:function(){if(this.state.id_responsable>0&&this.state.id_cuestionario)return React.createElement("input",{type:"button",className:"btn btn-success btn-block",value:"Iniciar Evaluacion De Cuestionario.",onClick:this.motrar_datos_evaluacion_curso.bind(this)})}},{key:"seleccion_responsable_boton",value:function(){var n=[React.createElement(Caja_datos,{icono:"glyphicon glyphicon-user",titulo:"Responsable",datos:this.state.responsable})];return this.state.evaluando===!1&&n.push(React.createElement("i",{className:"glyphicon glyphicon-search","data-toggle":"modal","data-target":"#modal_",onClick:this.on_seleccionar_de_tabla_modal_responsable.bind(this)})),React.createElement("div",{style:{width:"90%",display:"inline-block","margin-left":"20px"}},n)}},{key:"datos_cuestionarios",value:function(){var n=this;return console.log("Asignados"),this.lista_cuestionarios_asignados.map(function(t){return React.createElement("tr",{onClick:function(){n.on_seleccionar_cuestionario_de_tabla(t)}},React.createElement("td",null,t.folio),React.createElement("td",null,t.cuestionario),React.createElement("td",null,t.departamento),React.createElement("td",null,t.aplicador),React.createElement("td",null,t.inicio),React.createElement("td",null,t.termino),React.createElement("td",null,t.estatus))})}},{key:"datos_zonas_cuestionarios",value:function(){var n=this;this.cavecera_tabla_principal=["Zonas De Evaluacion : "];console.log("Zonas");this.tabla_principal=this.lista_zonas_por_asignacion.map(function(t){return React.createElement("input",{type:"button",className:"btn btn-info btn-block btn-zonas","data-toggle":"modal","data-target":"#moda_ckl",value:t.nombre||"indefinida",onClick:function(){return n.mostrar(t)}})})}},{key:"motrar_responsables",value:function(){console.log(this.state.id_responsable+"=>"+this.state.responsable)}},{key:"datos_responsables",value:function(n){var t=this,i=this.lista_responsables.filter(function(t){return t.nombre.toUpperCase().search(n.toUpperCase())>=0||t.puesto.toUpperCase().search(n.toUpperCase())>=0});return i.map(function(n){if(n.id_aplicador!=parseInt(ID_SCOI))return React.createElement("tr",{onClick:function(){return t.seleccion_responsable_de_modal(n)}},React.createElement("td",null,n.folio),React.createElement("td",null,n.nombre),React.createElement("td",null,n.puesto));console.log(n.id_aplicador)})}},{key:"mostrar",value:function(n){console.log("Folio Zona : "+n.folio+","+n.nombre);this.lista_datos_por_zona=conexion_ajax("servicios/servicios_generales/conexiones.asmx/obtener_resultados_cuestionarios_asignados_zona",{asignacion:this.state.folio_asignacion,zona:n.folio});console.log(this.state.id_cuestionario);console.log(this.lista_datos_por_zona);this.lista_observaciones=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_ver_observaciones_por_activo",{asignacion:this.state.folio_asignacion,folio_zona:n.folio})||[];this.setState({seleccion_zona:n})}}]),t}(React.Component),Modal_cuestionario=function(n){function t(n){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n);this.lista_observaciones=[];this.activo={folio:0,nombre:"",criterio:"",orden:0};this.componentes_observaciones=this.datos_observaciones();this.lista_servicios_por_cuestionario=[];this.state={posicion:-1,cantidad_obs:0,texto_observacion:""}}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){var i=this,n,t;return this.lista_observaciones=this.lista_observaciones.length==0?this.props.lista_observacion:this.lista_observaciones,n={folio:this.props.folio_establecimiento,nombre:this.props.establecimiento},t=React.createElement("div",null,React.createElement("h4",null,this.props.establecimiento),React.createElement("h5",null,"Zona : ",this.props.zona.nombre,".")),React.createElement("div",null,React.createElement(Modal,{cavecera:t,cuerpo:this.cuerpo_modal(),id:"moda_ckl",cerrar:this.on_deshacer.bind(this)}),React.createElement(Enviar_servicio_moda,{departamento:this.props.departamento,establecimiento:n,activo:this.activo,servicios:this.lista_servicios_por_cuestionario,on_guardar:function(){return i.responder("NO")}}))}},{key:"cuerpo_modal",value:function(){return React.createElement("div",null,React.createElement(Caja_datos,{icono:"glyphicon glyphicon-edit",titulo:"Activo",datos:this.activo.nombre}),React.createElement(Caja_datos,{icono:"glyphicon glyphicon-edit",titulo:"Criterio",datos:this.activo.criterio}),this.componente_evaluacion(),this.componente_observaciones(),React.createElement("div",{className:"tabla_cuestiones"},React.createElement(Tabla,{cavecera:["#","Activo A Inspeccionar","Evaluacion"],datos:this.datos_tabla()})),React.createElement("input",{type:"button",className:"btn btn-success btn-block",value:"Guardar Evaluacion",onClick:this.on_guardar_resultados_cuestionario.bind(this)}))}},{key:"on_guardar_resultados_cuestionario",value:function(){var i=this,n,t,r;console.log("Guardar...");console.log(this.props.datos_zona);console.log(this.lista_observaciones);n=[];t=[];this.props.datos_zona.forEach(function(r,u){r.solucion!="  "&&(i.lista_observaciones.forEach(function(n){r.folio_activo==n.folio&&t.push([u,n.observacion])}),n.push(r.folio_resultado+","+i.props.asignacion+","+r.folio_activo+","+r.folio_criterio+",'"+r.solucion+"',"+ID_SCOI+","+i.props.responsable))});n.length==this.props.datos_zona.length?(console.log(n),console.log(t),r=conexion_ajax("servicios/servicios_generales/conexiones.asmx/guardar_resultados_cuestionarios_asignados_zona",{datos_cuestionario:n,observaciones:t}),alert("Guardado..."),this.on_deshacer(),console.log(r)):alert("Datos incompletos!!!")}},{key:"on_deshacer",value:function(){console.log("Deshacer");this.lista_observaciones=[];this.activo={folio:0,nombre:"",criterio:"",orden:0};this.componentes_observaciones=this.datos_observaciones();this.lista_servicios_por_cuestionario=[];this.setState({posicion:-1,cantidad_obs:0,texto_observacion:""})}},{key:"on_tabla_activo",value:function(n,t){console.log(n);this.activo={folio:n.folio_activo,nombre:n.detalle_activo,criterio:n.detalle_criterio,orden:n.orden};console.log("Posicion : "+t);this.componentes_observaciones=this.datos_observaciones();this.setState({posicion:t})}},{key:"texto_observaciones",value:function(n){this.setState({texto_observacion:n.target.value})}},{key:"agregar_observacion",value:function(){this.state.texto_observacion&&this.activo.folio>0?(this.lista_observaciones.push({folio:this.activo.folio,observacion:this.state.texto_observacion}),console.log({folio:this.activo.folio,observacion:this.state.texto_observacion}),this.componentes_observaciones=this.datos_observaciones(),this.setState({texto_observacion:""})):alert("Coloque Texto En El Campo!!!")}},{key:"eliminar_observaciones",value:function(n){var t=this.lista_observaciones.indexOf(n);this.lista_observaciones.splice(t,1);this.componentes_observaciones=this.datos_observaciones();this.setState({cantidad_obs:this.lista_observaciones.length})}},{key:"seleccion_icono_res",value:function(n){var t="glyphicon glyphicon-question-sign";return n=="SI"?t="glyphicon glyphicon-ok-sign":n=="NO"?t="glyphicon glyphicon-remove-sign":n=="NA"&&(t="glyphicon glyphicon-minus-sign"),t}},{key:"get_servicios",value:function(){this.lista_servicios_por_cuestionario=conexion_ajax("servicios/servicios_generales/conexiones.asmx/servicios_por_orden_activo_ckl",{cuestionario:this.props.cuestionario,orden:this.activo.orden})||[];this.setState({texto_observacion:""})}},{key:"responder",value:function(n){console.log(n);var t=this.state.posicion;t>-1?(this.props.datos_zona[t].solucion=n,this.setState({posicion:t})):alert("Seleccione Un Activo!!!")}},{key:"componente_evaluacion",value:function(){var n=this,t=this.state.posicion;if(t>-1)return React.createElement("div",{className:"botonera_respuesta",style:{"text-align":"center"}},React.createElement("span",{title:"SI",className:this.seleccion_icono_res("SI"),onClick:function(){return n.responder("SI")}}),React.createElement("span",{title:"NO",className:this.seleccion_icono_res("NO"),"data-toggle":"modal","data-target":"#moda_servicios",onClick:function(){return n.get_servicios()}}),React.createElement("span",{title:"NA",className:this.seleccion_icono_res("NA"),onClick:function(){return n.responder("NA")}}))}},{key:"componente_observaciones",value:function(){var n=React.createElement("p",{style:{"font-size":"15px",display:"inline-block","margin-bottom":"0"}},"Observaciones  ");return React.createElement("div",null,React.createElement("label",null,React.createElement(Botones_dropdown,{titulo:n,opciones_menu:this.componentes_observaciones})),React.createElement("input",{type:"text",style:{width:"70%",display:"inline-block"},className:"form-control",placeholder:"Agregar Observaciones",value:this.state.texto_observacion,onChange:this.texto_observaciones.bind(this)}),React.createElement("i",{className:"glyphicon glyphicon-plus-sign blue",style:{display:"inline-block","font-size":"30px","margin-left":"10px"},onClick:this.agregar_observacion.bind(this)}))}},{key:"datos_observaciones",value:function(){var n=this;return this.lista_observaciones.map(function(t){return console.log(t.folio+":"+n.activo.folio),t.folio==n.activo.folio?React.createElement("div",{style:{height:"30px"},key:t.folio},t.observacion,React.createElement("section",{className:"glyphicon glyphicon-remove close",onClick:function(){n.eliminar_observaciones(t)}})):void 0})}},{key:"datos_tabla",value:function(){var n=this;return this.props.datos_zona.map(function(t,i){var r=n.seleccion_icono_res(t.solucion);return React.createElement("tr",{title:t.detalle_criterio,onClick:function(){return n.on_tabla_activo(t,i)}},React.createElement("td",null,i+1),React.createElement("td",null,React.createElement("h4",null,"Activo : ",t.detalle_activo),React.createElement("p",null,"Criterio : ",t.detalle_criterio)),React.createElement("td",{style:{width:"50px"}},React.createElement("span",{className:r})))})}}]),t}(React.Component),Enviar_servicio_moda=function(n){function t(n){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n);this.lista_Prioridades=conexion_ajax("servicios/servicios_generales/conexiones.asmx/obtener_lista_prioridades")||[];this.lista_servicios_cuestionario=[];this.state={descripcion:"",servicio:{folio:1,nombre:""},prioridad:this.lista_Prioridades[0].folio}}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return this.titulo=React.createElement("div",null,React.createElement("h5",null,"Descripcio De La Solisitud Del Servicio."),"Establecimiento : ",this.props.establecimiento.nombre,"."),React.createElement(Modal,{cavecera:this.titulo,cuerpo:this.cuerpo_modal(),id:"moda_servicios",cerrar:this.props.on_deshacer})}},{key:"cuerpo_modal",value:function(){return React.createElement("div",{className:"form-group"},React.createElement("label",null,"Activo : ",this.props.activo.nombre),React.createElement("br",null),React.createElement("label",null,"Prioridad : "),React.createElement("select",{className:"form-control",onChange:this.on_prioridad.bind(this)},this.datos_prioridades()),React.createElement("br",null),React.createElement("label",null,"Describa el Detalle Del Servicio Solicitado"),React.createElement("textarea",{style:{resize:"none"},value:this.state.descripcion,onChange:this.on_cambiar_detalle.bind(this),placeholder:"Describa Claramente El Detalle Del Servicio Solisitado",wrap:"soft",characters:"on",className:"form-control",rows:"3"}),React.createElement("br",null),React.createElement("div",{className:"tabla_matriz"},React.createElement(Tabla,{cavecera:["","Folio","Servicio","Descripcion"],datos:this.datos_servicios()})),React.createElement("input",{type:"button",value:"Guardar.","data-dismiss":"modal",className:"btn btn-success btn-block",onClick:this.on_enviar_servicio.bind(this)}))}},{key:"on_prioridad",value:function(n){console.log(n.target.value);this.setState({prioridad:n.target.value})}},{key:"on_cambiar_detalle",value:function(n){this.setState({descripcion:n.target.value})}},{key:"on_enviar_servicio",value:function(){var n,t;this.state.servicio.folio>0&&this.state.descripcion!=""&&this.state.prioridad?(this.props.on_guardar(),n=this.state.servicio.folio+","+this.props.activo.folio+",'"+this.state.descripcion+"',"+this.state.prioridad+","+this.props.departamento+","+this.props.establecimiento.folio+","+ID_SCOI+",'"+IP_CLIENTE+"'",console.log(n),t=conexion_ajax("servicios/servicios_generales/conexiones.asmx/enviar_solicitud_servicio",{datos:n}),t>0&&alert("Guardado...\nFolio : "+t)):alert("Datos Incompletos...\nCancelado!!!");this.setState({escripcion:"",servicio:{folio:1,nombre:""},prioridad:this.lista_Prioridades[0].folio})}},{key:"datos_prioridades",value:function(){var n=this;return this.lista_Prioridades.map(function(t){return React.createElement("option",{value:t.folio,selected:t.folio==n.state.prioridad},t.nombre)})}},{key:"datos_servicios",value:function(){var n=this;return this.lista_servicios_cuestionario,this.props.servicios.map(function(t){return React.createElement("tr",null,React.createElement("td",null,React.createElement("input",{type:"checkbox",onClick:function(){return n.checar_servicio_seleccionado(t)},checked:n.state.servicio.folio==t.folio})),React.createElement("td",null,t.folio),React.createElement("td",null,t.nombre),React.createElement("td",null,t.detalle))})}},{key:"checar_servicio_seleccionado",value:function(n){this.setState({servicio:n})}}]),t}(React.Component);ReactDOM.render(React.createElement(Check_list,null),document.getElementById("contenedor"));