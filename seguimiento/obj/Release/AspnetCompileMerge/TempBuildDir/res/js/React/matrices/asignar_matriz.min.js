"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),_get=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}},Modal=function(n){function t(){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){var n=this.props.id,t=this.props.cavecera||React.createElement("h3",null,"Sin datos"),i=this.props.cuerpo||React.createElement("h3",null,"Sin datos");return React.createElement("div",{id:n,className:"modal fade",role:"dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("button",{type:"button",className:"close","data-dismiss":"modal"},"×"),t),React.createElement("div",{className:"modal-body"},i),React.createElement("div",{className:"modal-footer"})))}}]),t}(React.Component),Modal_con_tabla=function(n){function t(){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){var n=React.createElement("h3",null," ",this.props.titulo),t=[React.createElement(Btn_seleccion,{guardar:this.props.guardar,deshacer:this.props.deshacer}),React.createElement(Caja_datos,{titilo:this.props.titilo,icono:this.props.icono,datos:this.props.seleccionado}),React.createElement(Caja_datos,{titilo:"Filtro",icono:"glyphicon glyphicon-filter",datos:this.props.texto_filtro,evento:this.props.filtrar}),React.createElement("div",{className:"tabla_matriz"},React.createElement(Tabla,{cavecera:this.props.cavecera,datos:this.props.lista}))];return React.createElement("div",null,React.createElement(Modal,{cavecera:n,cuerpo:t,id:this.props.id}))}}]),t}(React.Component),Matriz=function(n){function t(n){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n);this.lista_matrices=conexion_ajax("servicios/matriz/conexiones.asmx/obtener_matriz")||[];this.lista_matrices_asignadas=conexion_ajax("servicios/matriz/conexiones.asmx/matrices_asignadas")||[];this.lista_usuarios=conexion_ajax("servicios/checkListServ.asmx/obtener_lideres",{tienda:"Todos"})||[];this.usuario_select={id_usuario:0,usuario:""};this.matriz_select={folio:0,nombre:""};this.nuevo=this.on_nuevo.bind(this);this.editar=this.on_editar.bind(this);this.guardar=this.on_guardar.bind(this);this.deshacer=this.on_deshacer.bind(this);this.sel_fecha=this.seleccionar_fecha.bind(this);this.filtrar_usuario=this.on_filtrar_usuario.bind(this);this.seleccionar_usuario=this.on_seleccionar_usuario.bind(this);this.des_seleccion_usuario=this.on_des_seleccion_usuario.bind(this);this.filtrar_matriz=this.on_filtrar_matriz.bind(this);this.seleccionar_matriz=this.on_seleccionar_matriz.bind(this);this.des_seleccion_matriz=this.on_des_seleccion_matriz.bind(this);this.nueva=!1;this["default"]={folio:0,folio_matriz:0,Matriz:"",id_usuario:0,usuario:"",fecha:"",filtro_usr:"",filtro_matriz:"",editable:!1};this.state=this["default"]}return _inherits(t,n),_createClass(t,[{key:"render",value:function(){return React.createElement("div",null,React.createElement(Botonera,{guardar:this.guardar,nuevo:this.nuevo,editar:this.editar,deshacer:this.deshacer,class_nuevo:this.nueva,class_editar:this.state.editable}),React.createElement("div",null,React.createElement(Caja_fecha,{titulo:"fecha",icono:"glyphicon glyphicon-calendar",datos:this.get_fecha(),evento:this.sel_fecha})),React.createElement(Caja_datos,{titulo:"Matriz",icono:"glyphicon glyphicon-list-alt",datos:this.state.Matriz}),this.on_mostrar_matrices(),React.createElement(Caja_datos,{titulo:"Usuario",icono:"glyphicon glyphicon-user",datos:this.state.usuario}),this.on_mostrar_ususarios(),React.createElement("div",{className:"tabla_matriz"},React.createElement(Tabla,{cavecera:["Folio","Matriz","Fecha asignacion","Modificacion","Usuario"],datos:this.datos_matrices_asignadas()})),React.createElement(Modal_con_tabla,{seleccionado:this.matriz_select.nombre,titulo:"Lista Matrices",icono:"glyphicon glyphicon-user",cavecera:["Folio","Matriz","Establecimiento","Fecha Alta","Usuario Alta","Estatus"],lista:this.datos_matrices(),id:"modal_matriz",texto_filtro:this.state.filtro_matriz,filtrar:this.filtrar_matriz,guardar:this.seleccionar_matriz,deshacer:this.des_seleccion_matriz}),React.createElement(Modal_con_tabla,{seleccionado:this.usuario_select.usuario,titulo:"Lista Usuarios",icono:"glyphicon glyphicon-user",cavecera:["Folio","Nombre","Puesto"],lista:this.datos_usuarios(),id:"modal_usuario",texto_filtro:this.state.filtro_usr,filtrar:this.filtrar_usuario,guardar:this.seleccionar_usuario,deshacer:this.des_seleccion_usuario}))}},{key:"on_nuevo",value:function(){this.state.editable==!1?(console.log("Nuevo"),this.nueva=!0,this["default"].folio=conexion_ajax("servicios/matriz/conexiones.asmx/ultimo_folio_matrices_asignadas"),this.setState(this["default"])):alert("Edicion En Progreso!!!")}},{key:"on_editar",value:function(){this.nueva?alert("En Proceso De Nueva Asignaccion!!!"):this.state.usuario!=""&&this.state.id_usuario>0?(console.log("Editar"),this.nueva=!0,this.setState({editable:!0})):alert("seleccione Matriz!!!")}},{key:"on_guardar",value:function(){if(this.state.folio_matriz>0&&this.state.id_usuario>0&&this.state.fecha.split("/")[0]>0){if(this.state.editable||this.nueva){var n=conexion_ajax("servicios/matriz/conexiones.asmx/guardar_matriz_asignada",this.state);n?(alert("Guardado!!!"),this.nueva=!1,this.setState(this["default"]),this.lista_matrices_asignadas=conexion_ajax("servicios/matriz/conexiones.asmx/matrices_asignadas")||[]):alert("Error")}}else alert("Falta Seleccionar Datos...")}},{key:"on_deshacer",value:function(){console.log("Deshacer");this.nueva=!1;this["default"].folio=0;this.setState(this["default"])}},{key:"seleccionar_fecha",value:function(n){var t=n.target.value.split("-");(this.nueva||this.state.editable)&&this.setState({fecha:t[2]+"/"+t[1]+"/"+t[0]})}},{key:"get_fecha",value:function(){var n=this.state.fecha.split("/");return n[2]+"-"+n[1]+"-"+n[0]}},{key:"on_tabla_matriz",value:function(n){this.nueva||this.state.editable?alert("Edicion en Curso!!!"):this.setState({folio:n.folio,folio_matriz:n.folio_matriz,Matriz:n.matriz,id_usuario:n.id_usuario,usuario:n.usuario,fecha:n.asignacion})}},{key:"on_filtrar_usuario",value:function(n){this.usuario_select={id_usuario:0,usuario:""};this.setState({filtro_usr:n.target.value})}},{key:"on_seleccionar_usuario",value:function(){this.setState({id_usuario:this.usuario_select.id_usuario,usuario:this.usuario_select.usuario})}},{key:"on_des_seleccion_usuario",value:function(){this.usuario_select={id_usuario:0,usuario:""};this.setState({id_usuario:0,usuario:""})}},{key:"on_mostrar_ususarios",value:function(){return this.nueva?React.createElement("input",{type:"button",className:"btn btn-info",onClick:this.props.evento,value:"Seleccionar","data-toggle":"modal","data-target":"#modal_usuario"}):null}},{key:"on_filtrar_matriz",value:function(n){this.matriz_select={folio:0,nombre:""};this.setState({filtro_matriz:n.target.value})}},{key:"on_seleccionar_matriz",value:function(){this.setState({folio_matriz:this.matriz_select.folio,Matriz:this.matriz_select.nombre})}},{key:"on_des_seleccion_matriz",value:function(){this.matriz_select={folio:0,nombre:""};this.setState({folio_matriz:0,Matriz:""})}},{key:"on_mostrar_matrices",value:function(){var n=this;return this.nueva&&!this.state.editable?React.createElement("input",{type:"button",className:"btn btn-info",onClick:function(){n.lista_matrices=conexion_ajax("servicios/matriz/conexiones.asmx/obtener_matriz")||[]},value:"Seleccionar","data-toggle":"modal","data-target":"#modal_matriz"}):null}},{key:"on_tabla_usuario",value:function(n){this.usuario_select={id_usuario:n.folio,usuario:n.nombre};this.setState({filtro_usr:""})}},{key:"on_tabla_matrices",value:function(n){n.estatus=="v"||n.estatus=="V"?(this.matriz_select={folio:n.folio,nombre:n.nombre},this.setState({filtro_matriz:""})):alert("Matriz Cancelada!!!")}},{key:"datos_matrices_asignadas",value:function(){var n=this;return this.lista_matrices_asignadas.map(function(t){return React.createElement("tr",{key:t.folio,onClick:function(){return n.on_tabla_matriz(t)}},React.createElement("td",null,t.folio_matriz),React.createElement("td",null,t.matriz),React.createElement("td",null,t.asignacion),React.createElement("td",null,t.fecha),React.createElement("td",null,t.usuario))})}},{key:"datos_usuarios",value:function(){var n=this,t=this.lista_usuarios.filter(function(t){return t.nombre.toUpperCase().search(n.state.filtro_usr.toUpperCase())>=0||t.puesto.toUpperCase().search(n.state.filtro_usr.toUpperCase())>=0||t.folio.toString().search(n.state.filtro_usr.toUpperCase())>=0?!0:!1});return t.map(function(t){return React.createElement("tr",{key:t.folio,onClick:function(){return n.on_tabla_usuario(t)}},React.createElement("td",null,t.folio),React.createElement("td",null,t.nombre),React.createElement("td",null,t.puesto))})}},{key:"datos_matrices",value:function(){var n=this,t=this.lista_matrices.filter(function(t){return t.establecimiento.toUpperCase().search(n.state.filtro_matriz.toUpperCase())>=0||t.nombre.toUpperCase().search(n.state.filtro_matriz.toUpperCase())>=0||t.usuario.toUpperCase().search(n.state.filtro_matriz.toUpperCase())>=0||t.folio.toString().search(n.state.filtro_matriz.toUpperCase())>=0?!0:!1});return t.map(function(t){return React.createElement("tr",{key:t.folio,onClick:function(){return n.on_tabla_matrices(t)}},React.createElement("td",null,t.folio),React.createElement("td",null,t.nombre),React.createElement("td",null,t.establecimiento),React.createElement("td",null,t.alta),React.createElement("td",null,t.usuario),React.createElement("td",null,t.estatus=="V"||t.estatus=="v"?"Vigente":"Cancelado"))})}}]),t}(React.Component);ReactDOM.render(React.createElement(Matriz,null),document.getElementById("contenedor"));