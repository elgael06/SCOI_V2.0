Imports MySql.Data.MySqlClient
Imports System.Data
Imports System.IO
Public Class relaciones
    Inherits System.Web.UI.Page
    Public conn As New MySqlConnection
    Public estadodeconexionprevia As ConnectionState
    Public comando As MySqlCommand
    Public adaptador As New MySqlDataAdapter

    Public consulta As String = ""
    Public sentencia As String = ""
    Public fecha As Date
    Public comentario As String = ""
    Public datareader As MySqlDataReader
    Public data As New DataSet

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        ' Esto sirve para cargar los controles una sola vez y no cada vez que se haga postback
        If Page.IsPostBack Then
            ' aqui no haremos nada
        Else
            'aca pones todos lo eventos y funciones que deben cargarse una unica vez
            limpiar_campos()
            llenar_dropdownlist()
            llenarddldusuarios()
            TabContainer1.ActiveTabIndex = 0
        End If
    End Sub

    Protected Sub Button12_Click(sender As Object, e As EventArgs) Handles Button2.Click
        ' agregamos cliente al perfil
        GridView1.Visible = True
        agregar_cliente()
    End Sub
    Sub agregar_cliente()
        'se crea una conexion a la base de datos MySQL
        Dim connection As MySqlConnection
        Dim cuentalineas As Integer
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State
        Try
            If connection.State = ConnectionState.Closed Then
                connection.Open()
            End If
            'se ejecuta una consulta SQL
            Dim ComandoSQL As New MySqlCommand("INSERT INTO clientes (codigo_puesto, nombre_puesto, id_perfil, perfil) VALUES ('" & DropDownList1.Text & "', '" & TextBox1.Text & "', '" & DropDownList2.Text & "', '" & TextBox2.Text & "')", connection)
            cuentalineas = ComandoSQL.ExecuteNonQuery
            If cuentalineas > 0 Then
                ' Response.Write("<script language=javascript>alert('Prospecto agregado correctamente');</script>")
                _llenargridview1()
                'Button3.Visible = True
                GridView1.AutoGenerateDeleteButton = False

            Else
                'Response.Write("<script language=javascript>alert('Los datos del prospecto NO han sido guardados');</script>")
            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub
    Sub _llenargridview1()
        'se crea una conexion a la base de datos MySQL
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State
        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Try
            Dim ComandoSQL As New MySqlCommand("SELECT id_cliente, perfil FROM clientes where codigo_puesto =  '" & DropDownList1.Text & "'", connection)
            Dim ds As New DataSet
            Dim da As New MySqlDataAdapter(ComandoSQL)
            da.Fill(ds)
            GridView1.DataSource = ds.Tables(0)
            GridView1.DataBind()
            'limpiamos campos para la siguiente captura
            TextBox2.Text = ""
        Catch ex As Exception
            Throw ex
        End Try
    End Sub
    Sub limpiar_campos()
        TextBox1.Text = "" : TextBox2.Text = "" : TextBox3.Text = ""
        GridView1.Visible = False : GridView2.Visible = False
    End Sub
    Sub llenar_dropdownlist()
        DropDownList1.Items.Clear()
        DropDownList2.Items.Clear()
        DropDownList3.Items.Clear()
        DropDownList5.Items.Clear()
        '----------------------------cargar DDL9---------------------------
        conn.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        conn.Open()
        consulta = "select codigo_puesto, nombre_puesto from perfiles;"
        comando = New MySqlCommand(consulta, conn)
        datareader = comando.ExecuteReader
        If datareader.HasRows Then
            While datareader.Read
                'asignamos el codigo de puesto a cada dropdownlist
                DropDownList1.Items.Add(datareader.GetValue(0))
                DropDownList2.Items.Add(datareader.GetValue(0))
                DropDownList3.Items.Add(datareader.GetValue(0))
                DropDownList5.Items.Add(datareader.GetValue(1))
            End While
        End If
        'cerramos la conexion con la tabla
        conn.Close()
    End Sub
    Sub llenarddldusuarios()
        DropDownList4.Items.Clear()
        '----------------------------cargar DDL4---------------------------
        conn.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        conn.Open()
        consulta = "select nombre_usuario from usuario;"
        comando = New MySqlCommand(consulta, conn)
        datareader = comando.ExecuteReader
        If datareader.HasRows Then
            While datareader.Read
                'asignamos el codigo de puesto a cada dropdownlist
                DropDownList4.Items.Add(datareader.GetValue(0))
            End While
        End If
        'cerramos la conexion con la tabla
        conn.Close()
    End Sub

    Private Sub DropDownList2_Load(sender As Object, e As EventArgs) Handles DropDownList2.Load
        carga_clientes()
    End Sub

    Protected Sub DropDownList2_SelectedIndexChanged(sender As Object, e As EventArgs) Handles DropDownList2.SelectedIndexChanged
        carga_clientes()
    End Sub
    Sub carga_clientes()
        ' REALIZAMOS LA CONSULTA DEL REGISTRO SOLICITADO EN TEXTBOX1.TEXT
        conn.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        conn.Open()
        consulta = "select nombre_puesto from perfiles where codigo_puesto= '" & DropDownList2.Text & "'"
        comando = New MySqlCommand(consulta, conn)
        datareader = comando.ExecuteReader
        ' si encontramos registros entonces colocamos la informacion en los textboxes correspondientes
        If datareader.HasRows Then
            While datareader.Read
                TextBox2.Text = datareader.GetValue(0)
            End While
            'cerramos la conexion
            conn.Close()
        End If
    End Sub

    Private Sub DropDownList3_Load(sender As Object, e As EventArgs) Handles DropDownList3.Load
        carga_proveedor()
    End Sub

    Protected Sub DropDownList3_SelectedIndexChanged(sender As Object, e As EventArgs) Handles DropDownList3.SelectedIndexChanged
        carga_proveedor()
    End Sub
    Sub carga_proveedor()
        ' REALIZAMOS LA CONSULTA DEL REGISTRO SOLICITADO EN TEXTBOX1.TEXT
        conn.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        conn.Open()
        consulta = "select nombre_puesto from perfiles where codigo_puesto= '" & DropDownList3.Text & "'"
        comando = New MySqlCommand(consulta, conn)
        datareader = comando.ExecuteReader
        ' si encontramos registros entonces colocamos la informacion en los textboxes correspondientes
        If datareader.HasRows Then
            While datareader.Read
                TextBox3.Text = datareader.GetValue(0)
            End While
            'cerramos la conexion
            conn.Close()
        End If

    End Sub

    Sub busca_perfil()
        If Button1.Text = "Buscar" Then
            ' REALIZAMOS LA CONSULTA DEL REGISTRO SOLICITADO EN TEXTBOX1.TEXT
            conn.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
            conn.Open()
            consulta = "select nombre_puesto from perfiles where codigo_puesto= '" & DropDownList1.Text & "'"
            comando = New MySqlCommand(consulta, conn)
            datareader = comando.ExecuteReader
            ' si encontramos registros entonces colocamos la informacion en los textboxes correspondientes
            If datareader.HasRows Then
                While datareader.Read
                    ' colocamos la informacion del query en cada uno de los elementos
                    TextBox1.Text = datareader.GetValue(0)
                End While
                'Button1.Text = "Limpiar"
                'cerramos la conexion
                conn.Close()
            End If
        ElseIf Button1.Text = "Limpiar" Then
            limpiar_campos()
            Button1.Text = "Buscar"
        End If
    End Sub
    Sub consulta_clientes()
        'se crea una conexion a la base de datos MySQL
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State
        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Try
            Dim ComandoSQL As New MySqlCommand("select id_cliente, perfil from clientes where codigo_puesto= '" & DropDownList1.Text & "'", connection)
            Dim ds As New DataSet
            Dim da As New MySqlDataAdapter(ComandoSQL)
            da.Fill(ds)
            GridView1.DataSource = ds.Tables(0)
            GridView1.DataBind()
            GridView1.Visible = True
        Catch ex As Exception
            Throw ex
        End Try
    End Sub
    Sub consulta_proveedores()
        'se crea una conexion a la base de datos MySQL
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State
        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Try
            Dim ComandoSQL As New MySqlCommand("select id_proveedor, perfil from proveedores where codigo_puesto= '" & DropDownList1.Text & "'", connection)
            Dim ds As New DataSet
            Dim da As New MySqlDataAdapter(ComandoSQL)
            da.Fill(ds)
            GridView2.DataSource = ds.Tables(0)
            GridView2.DataBind()
            GridView2.Visible = True
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Protected Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        ' buscamos el perfil y cargamos la relaciones cliente proveedor
        If Button1.Text = "Buscar" Then
            consulta_clientes()
            consulta_proveedores()
            Button1.Text = "Limpiar"
        ElseIf Button1.Text = "Limpiar" Then
            limpiar_campos()
            Button1.Text = "Buscar"
            Button3.Visible = False : Button5.Visible = False
            GridView1.AutoGenerateDeleteButton = False
            GridView2.AutoGenerateDeleteButton = False
        End If
    End Sub

    Protected Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        ' agregamos elementos al gridview2
        GridView2.Visible = True
        agregar_proveedor()
    End Sub
    Sub agregar_proveedor()
        'se crea una conexion a la base de datos MySQL
        Dim connection As MySqlConnection
        Dim cuentalineas As Integer
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State
        Try
            If connection.State = ConnectionState.Closed Then
                connection.Open()
            End If
            'se ejecuta una consulta SQL
            Dim ComandoSQL As New MySqlCommand("INSERT INTO proveedores (codigo_puesto, nombre_puesto, id_perfil, perfil) VALUES ('" & DropDownList1.Text & "', '" & TextBox1.Text & "', '" & DropDownList3.Text & "', '" & TextBox3.Text & "')", connection)
            cuentalineas = ComandoSQL.ExecuteNonQuery
            If cuentalineas > 0 Then
                ' Response.Write("<script language=javascript>alert('Prospecto agregado correctamente');</script>")
                _llenargridview2()
                'Button5.Visible = True
                GridView2.AutoGenerateDeleteButton = False
            Else
                'Response.Write("<script language=javascript>alert('Los datos del prospecto NO han sido guardados');</script>")
            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub
    Sub _llenargridview2()
        'se crea una conexion a la base de datos MySQL
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State
        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Try
            Dim ComandoSQL As New MySqlCommand("SELECT id_proveedor, perfil FROM proveedores where codigo_puesto =  '" & DropDownList1.Text & "'", connection)
            Dim ds As New DataSet
            Dim da As New MySqlDataAdapter(ComandoSQL)
            da.Fill(ds)
            GridView2.DataSource = ds.Tables(0)
            GridView2.DataBind()
            'limpiamos campos para la siguiente captura
            TextBox3.Text = ""
        Catch ex As Exception
            Throw ex
        End Try

    End Sub

    Protected Sub GridView1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GridView1.SelectedIndexChanged
        ' seleccionamos el registro del gridview para borrar
        ' Obtiene la el valor de la linea seleccionada actualmente
        Dim row As GridViewRow = GridView1.SelectedRow
        TextBox4.Text = row.Cells(1).Text
        TextBox2.Text = row.Cells(2).Text
        GridView1.AutoGenerateDeleteButton = True
    End Sub

    Protected Sub GridView2_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GridView2.SelectedIndexChanged
        ' seleccionamos el registro del gridview para eliminar
        ' Obtiene la el valor de la linea seleccionada actualmente
        Dim row As GridViewRow = GridView2.SelectedRow
        TextBox5.Text = row.Cells(1).Text
        TextBox3.Text = row.Cells(2).Text
        GridView2.AutoGenerateDeleteButton = True
    End Sub

    Protected Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        ' eliminamos la responsabilidad seleccionada del gridview1
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State

        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Dim query As String = "DELETE FROM proveedores where id_proveedor=" & Val(TextBox5.Text)
        Dim cmd As New MySqlCommand(query, connection)
        cmd.ExecuteNonQuery()
        _llenargridview2()
    End Sub

    Protected Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        ' eliminamos el registro seleccionado del gridview1
        eliminar_cliente()
    End Sub
    Sub eliminar_cliente()
        ' eliminamos la responsabilidad seleccionada del gridview1
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State

        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Dim query As String = "DELETE FROM clientes where id_cliente=" & Val(TextBox4.Text)
        Dim cmd As New MySqlCommand(query, connection)
        cmd.ExecuteNonQuery()
        _llenargridview1()
    End Sub

    Private Sub DropDownList1_Load(sender As Object, e As EventArgs) Handles DropDownList1.Load
        'busca_perfil()
    End Sub

    Protected Sub DropDownList1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles DropDownList1.SelectedIndexChanged
        busca_perfil()
    End Sub

    Private Sub DropDownList4_Load(sender As Object, e As EventArgs) Handles DropDownList4.Load
        consulta_usuario()
    End Sub

    Protected Sub DropDownList4_SelectedIndexChanged(sender As Object, e As EventArgs) Handles DropDownList4.SelectedIndexChanged
        ' consulta usuario
        consulta_usuario()

    End Sub
    Sub consulta_usuario()
        ' REALIZAMOS LA CONSULTA DEL REGISTRO SOLICITADO EN TEXTBOX6.TEXT
        conn.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        conn.Open()
        consulta = "select id_usuario from usuario where nombre_usuario= '" & DropDownList4.Text & "'"
        comando = New MySqlCommand(consulta, conn)
        datareader = comando.ExecuteReader
        ' si encontramos registros entonces colocamos la informacion en los textboxes correspondientes
        If datareader.HasRows Then
            While datareader.Read
                TextBox6.Text = datareader.GetValue(0)
                GridView3.AutoGenerateDeleteButton = False
            End While
            Button7.Visible = False
            'cerramos la conexion
            conn.Close()
        End If
    End Sub

    Private Sub DropDownList5_Load(sender As Object, e As EventArgs) Handles DropDownList5.Load
        consulta_perfil()

    End Sub

    Protected Sub DropDownList5_SelectedIndexChanged(sender As Object, e As EventArgs) Handles DropDownList5.SelectedIndexChanged
        'consulta perfil
        consulta_perfil()
    End Sub
    Sub consulta_perfil()
        ' REALIZAMOS LA CONSULTA DEL REGISTRO SOLICITADO EN TEXTBOX7.TEXT
        conn.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        conn.Open()
        consulta = "select codigo_puesto from perfiles where nombre_puesto= '" & DropDownList5.Text & "'"
        comando = New MySqlCommand(consulta, conn)
        datareader = comando.ExecuteReader
        ' si encontramos registros entonces colocamos la informacion en los textboxes correspondientes
        If datareader.HasRows Then
            While datareader.Read
                TextBox7.Text = datareader.GetValue(0)
            End While
            _llenargridview3()
            'cerramos la conexion
            conn.Close()
        End If
    End Sub

    Protected Sub Button6_Click(sender As Object, e As EventArgs) Handles Button6.Click
        'agregarmos la relacion al gridview
        agregar_relacion()

    End Sub
    Sub agregar_relacion()
        'se crea una conexion a la base de datos MySQL
        Dim connection As MySqlConnection
        Dim cuentalineas As Integer
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State
        Try
            If connection.State = ConnectionState.Closed Then
                connection.Open()
            End If
            'se ejecuta una consulta SQL
            Dim ComandoSQL As New MySqlCommand("INSERT INTO relacionup (id_usuario, nombre_usuario, codigo_puesto, nombre_puesto) VALUES ('" & TextBox6.Text & "', '" & DropDownList4.Text & "', '" & TextBox7.Text & "', '" & DropDownList5.Text & "')", connection)
            cuentalineas = ComandoSQL.ExecuteNonQuery
            If cuentalineas > 0 Then
                ' Response.Write("<script language=javascript>alert('Prospecto agregado correctamente');</script>")
                _llenargridview3()
            Else
                'Response.Write("<script language=javascript>alert('Los datos del prospecto NO han sido guardados');</script>")
            End If
        Catch ex As Exception
            Throw ex
        End Try
    End Sub
    Sub _llenargridview3()
        'se crea una conexion a la base de datos MySQL
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State
        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Try
            Dim ComandoSQL As New MySqlCommand("SELECT id_relacion, id_usuario, nombre_usuario, codigo_puesto, nombre_puesto FROM relacionup where nombre_usuario =  '" & DropDownList4.Text & "'", connection)
            Dim ds As New DataSet
            Dim da As New MySqlDataAdapter(ComandoSQL)
            da.Fill(ds)
            GridView3.DataSource = ds.Tables(0)
            GridView3.DataBind()
        Catch ex As Exception
            Throw ex
        End Try
    End Sub

    Protected Sub Button7_Click(sender As Object, e As EventArgs) Handles Button7.Click
        ' eliminamos la relacion
        eliminar_relacion()

    End Sub
    Sub eliminar_relacion()
        ' eliminamos la responsabilidad seleccionada del gridview1
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State

        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Dim query As String = "DELETE FROM relacionup where id_relacion=" & Val(TextBox8.Text)
        Dim cmd As New MySqlCommand(query, connection)
        cmd.ExecuteNonQuery()
        _llenargridview3()
    End Sub

    Protected Sub GridView3_SelectedIndexChanged(sender As Object, e As EventArgs) Handles GridView3.SelectedIndexChanged
        ' seleccionamos el registro del gridview para borrar
        ' Obtiene la el valor de la linea seleccionada actualmente
        Dim row As GridViewRow = GridView3.SelectedRow
        TextBox8.Text = row.Cells(1).Text
        GridView3.AutoGenerateDeleteButton = True
    End Sub

    Private Sub GridView1_RowDeleting(sender As Object, e As GridViewDeleteEventArgs) Handles GridView1.RowDeleting
        ' eliminamos la responsabilidad seleccionada del gridview1
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State

        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Dim query As String = "DELETE FROM clientes where id_cliente=" & Val(TextBox4.Text)
        Dim cmd As New MySqlCommand(query, connection)
        cmd.ExecuteNonQuery()
        _llenargridview1()
    End Sub

    Private Sub GridView2_RowDeleting(sender As Object, e As GridViewDeleteEventArgs) Handles GridView2.RowDeleting
        ' eliminamos la responsabilidad seleccionada del gridview1
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State
        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Dim query As String = "DELETE FROM proveedores where id_proveedor=" & Val(TextBox5.Text)
        Dim cmd As New MySqlCommand(query, connection)
        cmd.ExecuteNonQuery()
        _llenargridview2()
    End Sub

    Private Sub GridView3_RowDeleting(sender As Object, e As GridViewDeleteEventArgs) Handles GridView3.RowDeleting
        ' eliminamos la responsabilidad seleccionada del gridview1
        Dim connection As MySqlConnection
        connection = New MySqlConnection
        'se apunta a la cadena de conexion guardada en el archivo Web.config
        connection.ConnectionString = System.Configuration.ConfigurationManager.ConnectionStrings("miconexion").ConnectionString
        Dim estadodeconexionprevia As ConnectionState
        estadodeconexionprevia = connection.State

        If connection.State = ConnectionState.Closed Then
            connection.Open()
        End If
        Dim query As String = "DELETE FROM relacionup where id_relacion=" & Val(TextBox8.Text)
        Dim cmd As New MySqlCommand(query, connection)
        cmd.ExecuteNonQuery()
        _llenargridview3()
    End Sub
End Class